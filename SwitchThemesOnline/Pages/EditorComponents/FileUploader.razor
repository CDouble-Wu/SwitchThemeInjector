@using System.IO;
@inject Blazor.FileReader.IFileReaderService fileReaderService;
@inject IJSRuntime js;

<input type="file" id="dioboia" @ref="@inputTypeFileElement" @onchange="@ReadFile" accept="@Filter" hidden/>
<button class="btn--raised buttonCenter" @onclick="@(() => js.Click(inputTypeFileElement))">@Text</button>

@code {
[Parameter] string Text { get; set; }
[Parameter] string Filter { get; set; }
[Parameter] Action<MemoryStream> OnUpload { get; set; }
[Parameter] int FileCount { get; set; } = 1;

ElementRef inputTypeFileElement;

public async Task ReadFile()
{
	int c = 0;
	foreach (var file in await fileReaderService.CreateReference(inputTypeFileElement).EnumerateFilesAsync())
	{
		OnUpload(await file.CreateMemoryStreamAsync());
		if (++c >= FileCount) break;
	}
}
}
